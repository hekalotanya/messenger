(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{13:function(e,t,n){e.exports={app:"App_app__2ziFi",header:"App_header__2L3DO",appHeader:"App_appHeader__3VqWx",table:"App_table__1ESJA",navigation:"App_navigation__dUcBC",link:"App_link__1t642",logOutButton:"App_logOutButton__2lxp9",userInfo:"App_userInfo__1K6tZ",profileIcon:"App_profileIcon__2us_q"}},17:function(e,t,n){e.exports={container:"UsersList_container__vTwVD",list:"UsersList_list__2AeyC",list__item:"UsersList_list__item__3a1xr",createChatButton:"UsersList_createChatButton__2iGD_",error:"UsersList_error__1fMBK"}},30:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),s=n(24),c=n.n(s),u=(n(30),n(2)),i=n.n(u),o=n(3),l=n(6),p=n(15),j=n(4),h=n(13),b=n.n(h),d=n(11),f=n(14),m="https://hekalot-messenger.herokuapp.com",O=function(){var e=Object(o.a)(i.a.mark((function e(t,n){var a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null,e.prev=1,e.next=4,fetch("".concat(m,"/sign-up"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})});case 4:if(!(r=e.sent).ok){e.next=9;break}return e.next=8,r.json();case 8:a=e.sent;case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(1),new Error(e.t0);case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,n){return e.apply(this,arguments)}}(),x=n(7),_=n.n(x),v=n(0),g=function(e){var t=e.user,n=e.setUser,r=Object(a.useState)({username:"",password:""}),s=Object(l.a)(r,2),c=s[0],u=s[1],h=Object(a.useState)(!1),b=Object(l.a)(h,2),m=b[0],x=b[1],g=function(e){var t=e.target,n=t.name,a=t.value;u((function(e){return Object(f.a)(Object(f.a)({},e),{},Object(d.a)({},n,a))})),x(!1)},w=function(){var e=Object(o.a)(i.a.mark((function e(t){var a,r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=c.username,r=c.password,s=null,!a.trim()||!r.trim()){e.next=14;break}return e.next=6,O(a,r);case 6:if(s=e.sent,Object.keys(s).length){e.next=11;break}return x(!0),u({username:"",password:""}),e.abrupt("return");case 11:u({username:"",password:""}),localStorage.setItem("token",s.token),n(s);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(v.jsxs)("main",{className:_.a.container,children:[Object(v.jsx)("h1",{children:"Sign up"}),Object(v.jsxs)("form",{className:_.a.form,onSubmit:w,children:[Object(v.jsx)("input",{onChange:g,className:_.a.input,type:"text",name:"username",placeholder:"username",value:c.username}),Object(v.jsx)("input",{onChange:g,className:_.a.input,type:"password",name:"password",placeholder:"password",value:c.password}),m&&Object(v.jsx)("p",{className:_.a.error,children:"Such user already exists"}),Object(v.jsx)("button",{className:_.a.button,type:"submit",disabled:!c.password.trim()||!c.username.trim(),children:"sign up"})]}),Object(v.jsx)(p.c,{className:_.a.link,to:"/sign-in",children:"Have an account?"}),t&&Object(v.jsx)(j.a,{to:"/users"})]})},w=n(19),k=n.n(w),C=function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/chats/").concat(t));case 2:return n=e.sent,e.abrupt("return",n.json());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(o.a)(i.a.mark((function e(t,n,a){var r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.prev=1,e.next=4,fetch("".concat(m,"/chat/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({authorId:t,message:a})});case 4:if(!(s=e.sent).ok){e.next=9;break}return e.next=8,s.json();case 8:r=e.sent;case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(1),new Error(e.t0);case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,n,a){return e.apply(this,arguments)}}(),S=n(8),N=n.n(S),I=function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/chat/").concat(t));case 2:return n=e.sent,e.abrupt("return",n.json());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(e){var t=e.userId,n=Object(a.useState)(!1),r=Object(l.a)(n,2),s=r[0],c=r[1],u=Object(a.useState)([]),p=Object(l.a)(u,2),j=p[0],h=p[1],b=Object(a.useState)(0),f=Object(l.a)(b,2),m=f[0],O=f[1],x=Object(a.useState)(""),_=Object(l.a)(x,2),g=_[0],w=_[1],S=Object(a.useState)([]),U=Object(l.a)(S,2),L=U[0],B=U[1],E=Object(a.useRef)(null),T=Object(a.useCallback)(Object(o.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return c(!0),e.next=5,C(t);case 5:n=e.sent,h(n),c(!1);case 8:case"end":return e.stop()}}),e)}))),[t]),A=Object(a.useCallback)(Object(o.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m){e.next=5;break}return e.next=3,I(m);case 3:t=e.sent,B(t);case 5:case"end":return e.stop()}}),e)}))),[m]);return Object(a.useEffect)((function(){var e=setInterval((function(){A()}),500);return function(){clearInterval(e)}})),Object(a.useEffect)((function(){E.current&&E.current.scrollIntoView({behavior:"smooth"})}),[E.current]),Object(a.useEffect)((function(){T()}),[T]),t?Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)("div",{className:N.a.container,children:[Object(v.jsx)("aside",{className:N.a.chatsList,children:Object(v.jsx)("ul",{className:N.a.list,children:!s&&j.map((function(e){return Object(v.jsx)("li",{"aria-hidden":!0,className:k()(N.a.listItem,Object(d.a)({},N.a.selectedChat,m===e.id)),onClick:function(){O(e.id)},children:"Chat #".concat(e.id," with ").concat(t===e.senderId?e.recipientId:e.senderId)},e.id)}))})}),Object(v.jsxs)("main",{className:k()(N.a.chat,Object(d.a)({},N.a.noChatSelected,0===m)),children:[m?Object(v.jsx)("h3",{className:N.a.title,children:"Selected chat #".concat(m)}):Object(v.jsx)("h3",{children:"select a chat"}),0!==m&&Object(v.jsx)("div",{className:N.a.messagesContainer,children:Object(v.jsx)("ul",{className:N.a.messagesList,children:L.map((function(e,n,a){return Object(v.jsx)("li",{ref:n===a.length-1?E:null,className:k()(N.a.messageItem,Object(d.a)({},N.a.myMessage,e.authorId===t)),children:e.message},e.id)}))})}),0!==m&&Object(v.jsxs)("form",{className:N.a.inputContainer,onSubmit:function(){var e=Object(o.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,y(t,m,g);case 3:w("");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(v.jsx)("input",{className:N.a.messageInput,value:g,onChange:function(e){return w(e.target.value)},type:"text"}),Object(v.jsx)("button",{type:"submit",className:N.a.sendButton,children:"send"})]})]})]})}):null},L=function(){var e=Object(o.a)(i.a.mark((function e(t,n){var a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null,e.prev=1,e.next=4,fetch("".concat(m,"/sign-in"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})});case 4:if(!(r=e.sent).ok){e.next=9;break}return e.next=8,r.json();case 8:a=e.sent;case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(1),new Error(e.t0);case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,n){return e.apply(this,arguments)}}(),B=function(e){var t=e.user,n=e.setUser,r=Object(a.useState)({username:"",password:""}),s=Object(l.a)(r,2),c=s[0],u=s[1],h=Object(a.useState)(!1),b=Object(l.a)(h,2),m=b[0],O=b[1],x=function(e){var t=e.target,n=t.name,a=t.value;u((function(e){return Object(f.a)(Object(f.a)({},e),{},Object(d.a)({},n,a))})),O(!1)},g=function(){var e=Object(o.a)(i.a.mark((function e(t){var a,r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=c.username,r=c.password,s=null,!a.trim()||!r.trim()){e.next=14;break}return e.next=6,L(a,r);case 6:if(s=e.sent,Object.keys(s).length){e.next=11;break}return O(!0),u({username:"",password:""}),e.abrupt("return");case 11:u({username:"",password:""}),localStorage.setItem("token",s.token),n(s);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(v.jsxs)("main",{className:_.a.container,children:[Object(v.jsx)("h1",{children:"Sign in"}),Object(v.jsxs)("form",{className:_.a.form,onSubmit:g,children:[Object(v.jsx)("input",{onChange:x,className:_.a.input,type:"text",name:"username",placeholder:"username",value:c.username}),Object(v.jsx)("input",{onChange:x,className:_.a.input,type:"password",name:"password",placeholder:"password",value:c.password}),m&&Object(v.jsx)("p",{className:_.a.error,children:"There is no such user"}),Object(v.jsx)("button",{className:_.a.button,type:"submit",disabled:!c.password.trim()||!c.username.trim(),children:"sign in"})]}),Object(v.jsx)(p.c,{className:_.a.link,to:"/sign-up",children:"Create an account"}),t&&Object(v.jsx)(j.a,{to:"/users"})]})},E=function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/user/").concat(t));case 2:return n=e.sent,e.abrupt("return",n.json());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/users/").concat(t));case 2:return n=e.sent,e.abrupt("return",n.json());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=Object(o.a)(i.a.mark((function e(t,n){var a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null,e.prev=1,e.next=4,fetch("".concat(m,"/chats"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:t,recipientId:n})});case 4:if(!(r=e.sent).ok){e.next=9;break}return e.next=8,r.json();case 8:a=e.sent;case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(1),new Error(e.t0);case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,n){return e.apply(this,arguments)}}(),J=n(17),H=n.n(J),D=function(e){var t=e.user,n=Object(a.useState)(!1),r=Object(l.a)(n,2),s=r[0],c=r[1],u=Object(a.useState)([]),p=Object(l.a)(u,2),j=p[0],h=p[1],b=Object(a.useState)({}),m=Object(l.a)(b,2),O=m[0],x=m[1],_=Object(a.useCallback)(Object(o.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),e.next=3,T(t.id);case 3:n=e.sent,h(n),c(!1);case 6:case"end":return e.stop()}}),e)}))),[t]);return Object(a.useEffect)((function(){_()}),[_]),Object(v.jsxs)("main",{className:H.a.container,children:[Object(v.jsx)("h1",{children:"Users to chat with"}),Object(v.jsx)("ul",{className:H.a.list,children:!s&&j.length>0&&j.map((function(e){return Object(v.jsxs)("li",{className:H.a.list__item,children:["".concat(e.username,"(").concat(e.id,")"),O["".concat(e.id)]&&Object(v.jsx)("span",{className:H.a.error,children:"you already have a chat with this user"}),Object(v.jsx)("button",{className:H.a.createChatButton,type:"button",title:"create chat",onClick:Object(o.a)(i.a.mark((function n(){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,A(t.id,e.id);case 2:a=n.sent,Object.keys(a).length||x((function(t){return Object(f.a)(Object(f.a)({},t),{},Object(d.a)({},e.id,!0))}));case 4:case"end":return n.stop()}}),n)}))),children:Object(v.jsx)("img",{src:"https://www.svgrepo.com/show/59167/chat.svg",alt:"send message"})})]},e.id)}))})]})},M=function(){var e=Object(a.useState)(null),t=Object(l.a)(e,2),n=t[0],r=t[1],s=localStorage.getItem("token"),c=Object(a.useCallback)(function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t);case 2:n=e.sent,r(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return Object(a.useEffect)((function(){!n&&s&&c(s)})),Object(v.jsxs)(p.a,{children:[Object(v.jsx)("div",{className:b.a.app,children:Object(v.jsxs)("header",{className:b.a.appHeader,children:[Object(v.jsx)("h1",{className:b.a.header,children:"Simple messenger"}),n&&Object(v.jsxs)("nav",{className:b.a.navigation,children:[Object(v.jsx)(p.b,{className:b.a.link,to:"/users",children:"users"}),Object(v.jsx)(p.b,{className:b.a.link,to:"/chats",children:"chats"})]}),n&&Object(v.jsxs)("div",{className:b.a.userInfo,title:"currently you are logged in as",children:[Object(v.jsx)("img",{src:"https://www.svgrepo.com/show/60372/profile-user.svg",alt:"profile pic",className:b.a.profileIcon}),Object(v.jsx)("span",{children:n.username})]}),n&&Object(v.jsx)("button",{className:b.a.logOutButton,type:"button",onClick:function(){r(null),localStorage.removeItem("token")},children:"Log out"})]})}),Object(v.jsxs)(j.d,{children:[Object(v.jsx)(j.b,{path:"/sign-up",children:Object(v.jsx)(g,{user:n,setUser:r})}),Object(v.jsx)(j.b,{path:"/sign-in",children:Object(v.jsx)(B,{user:n,setUser:r})}),!n&&!s&&Object(v.jsx)(j.a,{to:"/sign-in"}),Object(v.jsx)(j.b,{path:"/",exact:!0,children:Object(v.jsx)(j.a,{to:"/users"})}),Object(v.jsx)(j.b,{path:"/users",children:n&&Object(v.jsx)(D,{user:n})}),Object(v.jsx)(j.b,{path:"/chats",children:Object(v.jsx)(U,{userId:null===n||void 0===n?void 0:n.id})})]})]})};c.a.render(Object(v.jsx)(r.a.StrictMode,{children:Object(v.jsx)(M,{})}),document.getElementById("root"))},7:function(e,t,n){e.exports={container:"SignUp_container___8gj8",form:"SignUp_form__37NGc",input:"SignUp_input__1zju_",button:"SignUp_button__f3QJr",error:"SignUp_error__2HfVX",link:"SignUp_link__1BKSZ"}},8:function(e,t,n){e.exports={container:"Chats_container__3hli7",title:"Chats_title__2H04i",chatsList:"Chats_chatsList__1_VFh",list:"Chats_list__2x07o",listItem:"Chats_listItem__1sCai",selectedChat:"Chats_selectedChat__3ta07",chat:"Chats_chat__XpwSH",noChatSelected:"Chats_noChatSelected__w3sjT",inputContainer:"Chats_inputContainer__1YEU1",messageInput:"Chats_messageInput__3eMYV",sendButton:"Chats_sendButton__gnyhv",messagesContainer:"Chats_messagesContainer__qIidb",messagesList:"Chats_messagesList__3LpRt",messageItem:"Chats_messageItem__1Tg_s",myMessage:"Chats_myMessage__nPcxy"}}},[[41,1,2]]]);
//# sourceMappingURL=main.d686dacc.chunk.js.map